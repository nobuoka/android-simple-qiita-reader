Android アプリ 「Simple Qiita Reader」
========================================

アプリ全体の設計を考えるために作った小さなサンプルアプリです。

## アプリの内容

* Qiita の最近の投稿一覧を読み込んで表示する画面。
    * 最大 5 ページまで読み込みます。 リストの一番下までスクロールすることで自動で読み込まれます。
* 各投稿を表示する画面。

## 解決したい課題

現在開発しているアプリが抱えている課題のうち、新しい設計で解決していきたいもの。

* 外部 (Web API) とのやり取りをテスト時に扱いづらい。
* Android フレームワークとの連携の部分がテスト時に扱いづらい。
    * `SharedPreferences` や Activity のライフサイクルなど。
* クラス同士が密に連携しており、Local Unit Test が書きづらい。

## アプリ全体の設計

『実践ドメイン駆動設計』 や、ここ 1、2 年ほど web 上によく書かれている 「Android アプリで DDD + MVP」
のような話や、クリーンアーキテクチャなどを参考にしています。

* レイヤ化 (下のものが上のものに依存する)
    * ドメイン層 (今回のアプリにはない)
    * アプリケーション層
    * プレゼンテーション層 (この層の中では MVP パターンを使用)
    * インフラストラクチャ層
* 外部の Web API との通信や、複数の層にまたがって使用される単純なデータ構造として DTO を Kotlin で記述。
* 依存の方向を逆にするため (インフラストラクチャ層に他の層が依存しないように、など) Dagger 2 で DI を行う。
* 非同期処理、イベント伝搬のためにアプリ全体で RxJava を使用。

### 各層の詳細

#### ドメイン層

* ドメイン知識を表現する層。
* 例えば 「はてなブックマーク」 アプリの場合、URL の正規化周りの知識だったり、新規ブクマ追加のための情報の知識
  (非公開のときには Twitter 連携できない、など) がここで表現される。
* コアのライブラリ (RxJava とか) 以外には依存しない。

#### アプリケーション層

* アプリケーションとして動作するために必要な処理を置く層。

#### プレゼンテーション層

* 表示のための層。
* 内部ではさらにビュー、プレゼンター、プレゼンテーションモデル、という感じに分ける。

### このプロジェクトでの課題

* プレゼンテーション層の MVP がまだいい感じになっていない。
    * Activity / Fragment のライフサイクルとの組み合わせ。
    * 各 Activity に対応する Presenter を導入するのが良さそう。
        * Activity のライフサイクルメソッドを全て Presenter に移譲する。
    * Data binding や RecyclerView 当たりとの組み合わせをどうするか。
    * もうちょっとテストを書きやすくしたい。
* DI とスコープ周りを整理して Activity / Fragment のライフサイクルに合わせたスコープを導入したい。

## 手元でのビルド

[ComponentRecyclerAdapter](https://github.com/nobuoka/ComponentsRecyclerAdapter)
という自作のライブラリを Git サブモジュールとして追加しています。
下記のように `--recursive` オプションを付けて clone するなどして、サブモジュールも clone してください。

```
git clone --recursive https://github.com/nobuoka/android-simple-qiita-reader
```

環境変数 `ANDROID_HOME` を指定すれば (必要な Android SDK コンポーネントがインストール済みであれば)
通常どおり ``./gradlew assemble` コマンドでビルドできるはずです。
Android Studio 2.1 Preview 5 で開発をしていたため、Android Studio 1.5 では開けないかもしれません。
